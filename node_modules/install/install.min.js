makeInstaller=function(n){"use strict";function e(n,e){return i(n)&&s(e)&&q.call(n,e)}function t(n,e){return i(n)&&(p(E,n,e),u(j)&&j(O)),O}function r(n){this.id=n,this.children=[],this.childrenById={}}function o(n,t){return e(n,t)&&n[t]}function i(n){return null!==n&&"object"==typeof n}function u(n){return"function"==typeof n}function s(n){return"string"==typeof n}function c(n){return new Error("Cannot find module '"+n+"'")}function f(n){function e(e){var t=w(n,e);if(t)return d(t,n.module);var r=c(e);if(u(g))return g(e,n.module.id,r);throw r}return u(I)&&(e=I(e,n.module)),e.extensions=v(n).slice(0),e.resolve=function(e){var t=w(n,e);if(t)return t.module.id;var r=c(e);if(g&&u(g.resolve))return g.resolve(e,n.module.id,r);throw r},e}function l(n,e){this.parent=e=e||null,this.module=new r(n),B[n]=this,this.contents=null,this.deps={}}function d(n,t){var r=n.module;if(!e(r,"exports")){var o=n.contents;if(!o){if(n.stub)return n.stub;throw c(r.id)}if(t){r.parent=t;var i=t.children;Array.isArray(i)&&i.push(r)}u(r.useNode)&&r.useNode()||o(r.require=r.require||f(n),r.exports=n.stub||{},r,n.module.id,n.parent.module.id),r.loaded=!0}var s=r.runSetters||r.runModuleSetters;return u(s)&&s.call(r),r.exports}function a(n){return n&&i(n.contents)}function p(n,e,t){Array.isArray(e)?(e.forEach(function(t){s(t)?n.deps[t]=n.module.id:u(t)?e=t:i(t)&&(n.stub=n.stub||{},h(t,function(e,t){n.stub[t]=e}))}),u(e)||(e=null)):u(e)||s(e)||i(e)||(e=null),e&&(n.contents=n.contents||(i(e)?{}:e),i(e)&&a(n)&&h(e,function(e,r){if(".."===r)i=n.parent;else{var i=o(n.contents,r);i||((i=n.contents[r]=new l(n.module.id.replace(/\/*$/,"/")+r,n)).options=t)}p(i,e,t)}))}function h(n,e,t){Object.keys(n).forEach(function(t){e.call(this,n[t],t)},t)}function v(n){return n.options&&n.options.extensions||x}function m(n,e,t){for(;n&&!a(n);)n=n.parent;if(!n||!e||"."===e)return n;if(".."===e)return n.parent;var r=o(n.contents,e);if(t&&(!r||a(r)))for(var i=0;i<t.length;++i){var u=o(n.contents,e+t[i]);if(u&&!a(u))return u}return r}function y(n,e,t){var r=e.split("/");return r.every(function(e,o){return n=o<r.length-1?m(n,e):m(n,e,t)}),n}function b(n,e){var t=e&&e.module;n&&t&&(n.childrenById[t.id]=t)}function w(n,e,t,r){var t=t||n.module,o=v(n);for(n="/"===e.charAt(0)?y(E,e,o):"."===e.charAt(0)?y(n,e,o):function(n,e,t){u(k)&&(e=k(e,n.module.id));if(s(e)){for(var r;n&&!r;n=n.parent)r=a(n)&&y(n,"node_modules/"+e,t);return r}}(n,e,o);a(n);){if((r=r||[]).indexOf(n)<0){r.push(n);var i,c=m(n,"package.json"),f=c&&d(c,t);if(f&&A.some(function(n){return s(i=f[n])})&&(b(t,c),n=y(n,i,o)||w(n,i,t,r)))continue}n=m(n,"index.js")}return n&&s(n.contents)&&(n=w(n,n.contents,t,r)),b(t,n),n}var x=(n=n||{}).extensions||[".js",".json"],j=n.onInstall,I=n.wrapRequire,k=n.override,g=n.fallback,A=n.mainFields||(n.browser?["browser","main"]:["main"]),q={}.hasOwnProperty,B={},E=new l("/",new l("/..")),O=f(E);t.fetch=function(n){throw new Error("fetch not implemented")},r.prototype.resolve=function(n){return this.require.resolve(n)};var P,M;return r.prototype.prefetch=function(n){function e(n){var t=o(B,n.id);(function(n){return n&&null===n.contents})(t)&&!t.pending&&(t.pending=!0,(M=M||{})[n.id]={module:t.module,deps:Object.keys(t.deps),options:t.options,stub:t.stub},h(t.deps,function(n,e){w(t,e)}),h(n.childrenById,e))}var r=this,i=(o(B,r.id),P=P||Promise.resolve());return P=new Promise(function(t){var o=r.resolve(n);h(r.childrenById,e),t(o)}).then(function(n){var e=M;return M=null,Promise.resolve(e&&t.fetch(e)).then(function(e){function r(){return t(e),n}return i.then(r,r)})})},t.Module=r,t},"object"==typeof exports&&(exports.makeInstaller=makeInstaller);
